<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Midtrans Payment Form Template -->
    <template id="midtrans_form" name="Midtrans Payment Form">
        <div class="midtrans-payment-container">
            <input type="hidden" id="snap_token" t-att-value="snap_token"/>
            <input type="hidden" id="client_key" t-att-value="client_key"/>
            
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="mt-3">Mengalihkan ke halaman pembayaran Midtrans...</p>
            </div>
            
            <script type="text/javascript" 
                    t-att-src="snap_js_url" 
                    t-att-data-client-key="client_key">
            </script>
            
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function() {
                    var snapToken = document.getElementById('snap_token').value;
                    var clientKey = document.getElementById('client_key').value;
                    
                    if (typeof snap !== 'undefined' &amp;&amp; snapToken) {
                        snap.pay(snapToken, {
                            onSuccess: function(result) {
                                console.log('Payment success:', result);
                                window.location.href = '/payment/midtrans/return?order_id=' + result.order_id + '&amp;status=success';
                            },
                            onPending: function(result) {
                                console.log('Payment pending:', result);
                                window.location.href = '/payment/midtrans/return?order_id=' + result.order_id + '&amp;status=pending';
                            },
                            onError: function(result) {
                                console.log('Payment error:', result);
                                window.location.href = '/payment/midtrans/return?order_id=' + result.order_id + '&amp;status=error';
                            },
                            onClose: function() {
                                console.log('Payment popup closed');
                                window.location.href = '/shop/payment';
                            }
                        });
                    } else {
                        console.error('Snap.js not loaded or token missing');
                        setTimeout(function() {
                            window.location.href = '/shop/payment';
                        }, 3000);
                    }
                });
            </script>
        </div>
    </template>
</odoo>